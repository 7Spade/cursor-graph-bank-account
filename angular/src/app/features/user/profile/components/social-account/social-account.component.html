<mat-card class="social-account-card">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>share</mat-icon>
      社交帳戶
    </mat-card-title>
    <mat-card-subtitle>管理您的社交媒體帳戶連結</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <!-- Existing Accounts -->
    @if (hasAccounts()) {
      <div class="accounts-list">
        @for (account of socialAccounts(); track account.id) {
          <mat-chip-set>
            <mat-chip>
              <mat-icon>{{ getProviderInfo(account.provider).icon }}</mat-icon>
              {{ getProviderInfo(account.provider).name }}
              <button mat-icon-button 
                      (click)="onRemoveAccount(account)"
                      class="remove-button">
                <mat-icon>close</mat-icon>
              </button>
            </mat-chip>
          </mat-chip-set>
        }
      </div>
    } @else {
      <div class="no-accounts">
        <mat-icon>link_off</mat-icon>
        <p>尚未添加任何社交帳戶</p>
      </div>
    }

    <!-- Add Form -->
    @if (showAddForm()) {
      <div class="add-form">
        <form [formGroup]="socialAccountForm" (ngSubmit)="onAddAccount()">
          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>平台</mat-label>
              <mat-select formControlName="provider">
                @for (provider of providers; track provider.key) {
                  <mat-option [value]="provider.key">
                    <mat-icon>{{ provider.icon }}</mat-icon>
                    {{ provider.name }}
                  </mat-option>
                }
              </mat-select>
              <mat-error>{{ getFieldError('provider') }}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>用戶名</mat-label>
              <input matInput 
                     formControlName="username" 
                     placeholder="可選"
                     [class.error]="isFieldInvalid('username')">
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>URL</mat-label>
              <input matInput 
                     formControlName="url" 
                     placeholder="https://example.com"
                     [class.error]="isFieldInvalid('url')">
              <mat-error>{{ getFieldError('url') }}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-actions">
            <button mat-button 
                    type="button"
                    (click)="onCancelAdd()">
              取消
            </button>
            
            <button mat-raised-button 
                    color="primary"
                    type="submit"
                    [disabled]="!canAdd()">
              @if (loading()) {
                <ng-container>
                  <mat-icon>hourglass_empty</mat-icon>
                  添加中...
                </ng-container>
              } @else {
                <ng-container>
                  <mat-icon>add</mat-icon>
                  添加
                </ng-container>
              }
            </button>
          </div>
        </form>
      </div>
    } @else {
      <div class="add-button-container">
        <button mat-raised-button 
                color="primary"
                (click)="onShowAddForm()">
          <mat-icon>add</mat-icon>
          添加社交帳戶
        </button>
      </div>
    }
  </mat-card-content>
</mat-card>
