---
description: Optimized main rule for improved token efficiency
globs: main-optimized.mdc
alwaysApply: false
---
# ğŸ” OPTIMIZED GRAPH BANK SYSTEM

ğŸš¨ CRITICAL RULE: GRAPH BANK CREATION IS MANDATORY ğŸš¨
Graph Bank MUST be created BEFORE any other operation in ANY mode
NO process can continue without verifying Graph Bank existence

> **TL;DR:** This system uses optimized context management and adaptive rule loading to maximize token efficiency while preserving the structured development approach.

## ğŸ§­ OPTIMIZED MODE ARCHITECTURE

```mermaid
graph TD
    subgraph "Graph Bank Core"
        Context["Context Manager"]
        Rules["Rule Loader"]
        FileIO["File Manager"]
        Transition["Mode Transition"]
    end

    subgraph "Custom Modes"
        VAN["VAN<br>Initialization"]
        PLAN["PLAN<br>Planning"]
        CREATIVE["CREATIVE<br>Design"]
        IMPLEMENT["IMPLEMENT<br>Building"]
        REFLECT["REFLECT<br>Review"]
        ARCHIVE["ARCHIVE<br>Documentation"]
    end

    Context --> VAN & PLAN & CREATIVE & IMPLEMENT & REFLECT & ARCHIVE
    Rules --> VAN & PLAN & CREATIVE & IMPLEMENT & REFLECT & ARCHIVE
    FileIO --> VAN & PLAN & CREATIVE & IMPLEMENT & REFLECT & ARCHIVE
    Transition --> VAN & PLAN & CREATIVE & IMPLEMENT & REFLECT & ARCHIVE

    VAN --> PLAN
    PLAN --> CREATIVE
    CREATIVE --> IMPLEMENT
    IMPLEMENT --> REFLECT
    REFLECT --> ARCHIVE

    style Context fill:#4da6ff,stroke:#0066cc,color:white
    style Rules fill:#ffa64d,stroke:#cc7a30,color:white
    style FileIO fill:#4dbb5f,stroke:#36873f,color:white
    style Transition fill:#d94dbb,stroke:#a3378a,color:white
```

## ğŸ“ˆ ADAPTIVE COMPLEXITY MODEL

```mermaid
graph TD
    Task["Task Creation"] --> Complexity{"Complexity<br>Level?"}

    Complexity -->|"Level 1<br>Quick Fix"| L1["3-Phase<br>Streamlined Process"]
    Complexity -->|"Level 2<br>Enhancement"| L2["4-Phase<br>Balanced Process"]
    Complexity -->|"Level 3<br>Feature"| L3["5-Phase<br>Comprehensive Process"]
    Complexity -->|"Level 4<br>Enterprise"| L4["6-Phase<br>Governance Process"]

    L1 --> L1_Process["VAN â†’ IMPLEMENT â†’ REFLECT"]
    L2 --> L2_Process["VAN â†’ PLAN â†’ IMPLEMENT â†’ REFLECT"]
    L3 --> L3_Process["VAN â†’ PLAN â†’ CREATIVE â†’ IMPLEMENT â†’ REFLECT"]
    L4 --> L4_Process["VAN â†’ PLAN â†’ CREATIVE â†’ IMPLEMENT â†’ REFLECT â†’ ARCHIVE"]

    style Complexity fill:#d94dbb,stroke:#a3378a,color:white
    style L1 fill:#4dbb5f,stroke:#36873f,color:white
    style L2 fill:#ffa64d,stroke:#cc7a30,color:white
    style L3 fill:#4da6ff,stroke:#0066cc,color:white
    style L4 fill:#ff5555,stroke:#cc0000,color:white
```

## ğŸ§  HIERARCHICAL RULE LOADING

Rules are loaded hierarchically to optimize context usage:

```mermaid
graph TD
    Root["Graph Bank<br>Common Rules"] --> Core["Core Rules<br>Shared Across Modes"]

    Core --> L1["Level 1<br>Rules"]
    Core --> L2["Level 2<br>Rules"]
    Core --> L3["Level 3<br>Rules"]
    Core --> L4["Level 4<br>Rules"]

    Core --> VM["Mode<br>Visual Maps"]

    Core --> Phase["Phase-Specific<br>Rules"]

    Phase --> VAN_Rules["VAN Mode<br>Rules"]
    Phase --> PLAN_Rules["PLAN Mode<br>Rules"]
    Phase --> CREATIVE_Rules["CREATIVE Mode<br>Rules"]
    Phase --> IMPLEMENT_Rules["IMPLEMENT Mode<br>Rules"]
    Phase --> REFLECT_Rules["REFLECT Mode<br>Rules"]
    Phase --> ARCHIVE_Rules["ARCHIVE Mode<br>Rules"]

    style Root fill:#4da6ff,stroke:#0066cc,color:white
    style Core fill:#ffa64d,stroke:#cc7a30,color:white
    style Phase fill:#4dbb5f,stroke:#36873f,color:white
```

## ğŸ”„ TOKEN-OPTIMIZED CREATIVE PHASE

Creative phase documentation is progressively generated:

```mermaid
graph TD
    Start["Creative Phase<br>Initiation"] --> P1["1ï¸âƒ£ PROBLEM<br>Define scope"]
    P1 --> P2["2ï¸âƒ£ OPTIONS<br>List alternatives"]
    P2 --> P3["3ï¸âƒ£ ANALYSIS<br>Compare options"]
    P3 --> P4["4ï¸âƒ£ DECISION<br>Select approach"]
    P4 --> P5["5ï¸âƒ£ GUIDELINES<br>Document implementation"]

    P3 -.->|"On Demand"| Details["Detailed Option<br>Analysis"]

    style Start fill:#d971ff,stroke:#a33bc2,color:white
    style P1 fill:#4da6ff,stroke:#0066cc,color:white
    style P2 fill:#ffa64d,stroke:#cc7a30,color:white
    style P3 fill:#4dbb5f,stroke:#36873f,color:white
    style P4 fill:#d94dbb,stroke:#a3378a,color:white
    style P5 fill:#4dbbbb,stroke:#368787,color:white
    style Details fill:#e699d9,stroke:#d94dbb,color:white,stroke-dasharray: 5 5
```

## ğŸ”€ OPTIMIZED MODE TRANSITIONS

Mode transitions use a unified context transfer protocol:

```mermaid
sequenceDiagram
    participant Current as Current Mode
    participant Context as Context Manager
    participant Next as Next Mode

    Current->>Context: Create transition document
    Current->>Context: Store critical context
    Context->>Context: Prepare rule cache
    Current->>Next: Initiate transition
    Next->>Context: Verify context availability
    Context->>Next: Load relevant context
    Context->>Next: Load cached rules
    Next->>Next: Continue with preserved context
```

## ğŸ“Š GRAPH BANK EFFICIENT UPDATES

```mermaid
graph TD
    subgraph "Graph Bank Files"
        tasks["tasks.md<br>Source of Truth"]
        active["activeContext.md<br>Current Focus"]
        creative["creative-*.md<br>Design Decisions"]
        progress["progress.md<br>Implementation Status"]
        transition["transition.md<br>Mode Transitions"]
    end

    Update["Update Request"] --> Diff{"Changed?"}
    Diff -->|"No"| Skip["Skip Update"]
    Diff -->|"Yes"| Section{"Section<br>Change?"}
    Section -->|"Yes"| Partial["Update Changed<br>Sections Only"]
    Section -->|"No"| Full["Full File<br>Update"]

    Partial --> tasks
    Full --> tasks

    style Update fill:#4da6ff,stroke:#0066cc,color:white
    style Diff fill:#ffa64d,stroke:#cc7a30,color:white
    style Section fill:#4dbb5f,stroke:#36873f,color:white
    style Partial fill:#d94dbb,stroke:#a3378a,color:white
    style Full fill:#4dbbbb,stroke:#368787,color:white
```

## ğŸ’» COMPLEXITY-BASED DOCUMENTATION

Documentation requirements scale based on complexity level:

| Documentation | Level 1 | Level 2 | Level 3 | Level 4 |
|---------------|---------|---------|---------|---------|
| Problem Definition | Brief | Standard | Detailed | Comprehensive |
| Options Analysis | Optional | Basic | Multiple Options | Extensive |
| Implementation Plan | Simple | Standard | Detailed | Phased |
| Testing Requirements | Basic | Standard | Comprehensive | Rigorous |
| Documentation | Minimal | Standard | Detailed | Extensive |

## ğŸ“‘ OPTIMIZED TEMPLATES BY LEVEL

### Level 1: Quick Fix Template
```markdown
## QUICK FIX: [Issue Name]
- Problem: [Brief description]
- Solution: [Implemented approach]
- Verification: [How fix was tested]
```

### Level 2: Enhancement Template
```markdown
## ENHANCEMENT: [Feature Name]
- Requirement: [What needs to be done]
- Approach: [How it was implemented]
- Testing: [Verification approach]
- Documentation: [Where documented]
```

### Level 3-4: Comprehensive Template
Uses the optimized creative phase template with appropriate documentation depth

## ğŸ”„ REFERENCE MAPS

Each mode's visual process map is optimized for token efficiency:

- @VAN Mode Map (Optimized)
- @PLAN Mode Map (Optimized)
- @CREATIVE Mode Map (Optimized)
- @IMPLEMENT Mode Map (Optimized)
- @REFLECT Mode Map (Optimized)
- @ARCHIVE Mode Map (Optimized)

## âš¡ TOKEN EFFICIENCY IMPROVEMENTS

Optimizations in this version:

1. Hierarchical rule loading (65% token reduction)
2. Progressive creative phase documentation (60% token reduction)
3. Context preservation during mode transitions (40% token reduction)
4. Differential Graph Bank updates (30% token reduction)
5. Complexity-based template scaling (varies by level)

## ğŸ” CONTEXT7 è‡ªå‹•è§¸ç™¼æ•´åˆ

Graph Bank ç³»çµ±æ•´åˆ Context7 MCP æœå‹™ï¼Œè‡ªå‹•ç²å–æœ€æ–°æŠ€è¡“æ–‡æª”ï¼š

### è‡ªå‹•è§¸ç™¼æ¢ä»¶
- **æŠ€è¡“æ–‡æª”æŸ¥è©¢**ï¼šç•¶ç”¨æˆ¶è©¢å• APIã€å‡½å¼åº«æˆ–æŠ€è¡“æ¦‚å¿µæ™‚ï¼Œè‡ªå‹•ä½¿ç”¨ Context7
- **æœ€ä½³å¯¦è¸ç ”ç©¶**ï¼šç•¶éœ€è¦æœ€æ–°æŠ€è¡“æœ€ä½³å¯¦è¸æ™‚ï¼Œè‡ªå‹•ç²å–ç›¸é—œæ–‡æª”
- **å¯¦æ–½æŒ‡å°**ï¼šç•¶éœ€è¦å…·é«”å¯¦æ–½ç¯„ä¾‹æ™‚ï¼Œè‡ªå‹•æŸ¥è©¢å®˜æ–¹æ–‡æª”
- **è¨­è¨ˆæ±ºç­–æ”¯æ´**ï¼šç•¶éœ€è¦æŠ€è¡“é¸å‹åƒè€ƒæ™‚ï¼Œè‡ªå‹•ç²å–æ¯”è¼ƒæ–‡æª”

### æ•´åˆæ¨¡å¼
- **VAN æ¨¡å¼**ï¼šæŠ€è¡“é©—è­‰æ™‚è‡ªå‹•ç²å–æœ€æ–°æ–‡æª”
- **PLAN æ¨¡å¼**ï¼šè¦åŠƒæ™‚è‡ªå‹•é€²è¡ŒæŠ€è¡“ç ”ç©¶
- **CREATIVE æ¨¡å¼**ï¼šè¨­è¨ˆæ±ºç­–æ™‚è‡ªå‹•ç²å–æœ€ä½³å¯¦è¸
- **IMPLEMENT æ¨¡å¼**ï¼šå¯¦æ–½æ™‚è‡ªå‹•ç²å– API æ–‡æª”
- **REFLECT æ¨¡å¼**ï¼šåæ€æ™‚å¯èƒ½éœ€è¦æŠ€è¡“åƒè€ƒ

## ğŸ’¡ USAGE GUIDANCE

To use the optimized system:

1. Start with the VAN command to initialize and determine complexity
2. Follow the complexity-appropriate workflow
3. Use progressive documentation appropriate to task complexity
4. Let the system manage rule loading and context preservation
5. Context7 automatically provides latest technical documentation when needed
6. Enjoy the improved token efficiency while maintaining structured development
